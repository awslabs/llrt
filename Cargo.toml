[package]
name = "llrt"
version = "0.1.4-beta"
edition = "2021"

[features]
default = ["macro"]
lambda = []
no-sdk = []
macro = ["rquickjs/macro"]

[dependencies]
chrono = { version = "0.4.31", default-features = false, features = ["std"] }
quick-xml = "0.31.0"
crc32c = "0.6.4"
crc32fast = "1.3.2"
hyper = "0.14.27"
hyper-rustls = "0.25.0"
phf = "0.11.2"
md-5 = { version = "0.10.6", features = ["asm"] }
ring = "0.17.6"
rquickjs = { git = "https://github.com/DelSkayn/rquickjs", rev = "35b32d8fba34483b336d75b43e145d1ac75893db", features = [
    "full-async",
    "parallel",
], default-features = false }
tokio = { version = "1", features = ["full"] }
tracing = { version = "0.1.40", features = ["log"] }
uuid = { version = "1.6.1", default-features = false, features = [
    "v1",
    "v3",
    "v4",
    "v5",
    "fast-rng",
] }
rustls = "0.21.9"
once_cell = "1.18.0"
tokio-context = "0.1.3"
tracing-core = "0.1.32"
webpki = "0.22.4"
webpki-roots = "0.25.3"
async-trait = "0.1.74"
url = "2.5.0"
zstd = { version = "0.13.0", default-features = false, features = [] }
uname-rs = "0.1.1"
libc = "0.2.152"
base64-simd = "0.8.0"
hex-simd = "0.8.0"
socket2 = "0.5.5"
bytes = "1.5.0"
tokio-rustls = "0.24.1"
uuid-simd = "0.8.0"
simd-json = { version = "0.13.7", default-features = false, features = [
    "big-int-as-float",
] }
itoa = "1.0.10"
ryu = "1.0.16"
fxhash = "0.2.1"

[build-dependencies]
relative-path = "1.9.0"
rquickjs = { git = "https://github.com/DelSkayn/rquickjs", rev = "35b32d8fba34483b336d75b43e145d1ac75893db", features = [
    "full-async",
], default-features = false }
tokio = { version = "1", features = ["full"] }
phf_codegen = "0.11.2"
jwalk = "0.8.1"
nanoid = "0.4.0"

# [patch.crates-io]
# rquickjs = { path = "./target/patch/rquickjs" }

# [package.metadata.patch.rquickjs-core]
# patches = ["patches/spawn_order.patch"]

# [package.metadata.patch.rquickjs-sys]
# patches = [
#     "patches/print_invocation_time.patch"
# ]


[profile.flame]
inherits = "release"
strip = false
debug = true

[profile.release]
strip = true
lto = true
codegen-units = 1
opt-level = 3
panic = "abort"

[profile.test]
panic = "abort"
opt-level = 3 #required for large number parsing

[[bin]]
name = "llrt"
path = "src/main.rs"
